# addresses_converter

Скрипт конвертирования списка населенных пунктов и адреса задач в новую структуру.

Нужно создать конфиг config.yaml, где прописать реальные данные для соединения с базой Rethink.
Также в конфниге нужно указать имена таблиц

tasksTableName: tasks1 - таблица задач 

usersTableName: users1 - таблица пользователей

Можно закопировать данные во временную таблицу:
```
// создаем новую таблицу
r.db('имя базы').tableCreate('имя новой таблицы'); 
// копируем в нее данные
r.db('имя базы').table('имя новой таблицы').insert(r.db('delidela').table('имя старой таблицы')); 
```

И прогнать скипт по временным таблицам.

Скрипт проходит по всем пользователям и преобразует список населенных пунктов List<String> 
в список объектов List<Map> путем получения подсказок  в сервисе dadata.

Для снижения количества запросов к сервису dadata создается промежуточный Map, где ключом является содержимое поля
localities[i].

mainLocality через dadata также переносится в новый localities.

В localities попадают только уникальные нас. пункты. Т.е. если в mainLocality и в localities был
один и тот же населенный пункт, то в новый localities этот населенный пункт попадет один раз.

В localities_backup записывается старый localities.

Скрипт проходит по всем задачам.
1. Преобразует список населенных пунктов List<String> в список объектов List<Map> путем получения подсказок
в сервисе dadata.
2. Преобразует содержимое поле address.

Скрипт сам не заканчивается.
Недоразобрался. Если закрывать соединение с rethink, то должен закрываться, но вылетает по ошибке.

# запуск

```
pub run bin/main.dart
```

